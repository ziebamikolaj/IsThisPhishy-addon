(function(){"use strict";var Y={exports:{}},M={},Z={exports:{}},i={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I=Symbol.for("react.element"),ve=Symbol.for("react.portal"),Se=Symbol.for("react.fragment"),be=Symbol.for("react.strict_mode"),_e=Symbol.for("react.profiler"),xe=Symbol.for("react.provider"),je=Symbol.for("react.context"),$e=Symbol.for("react.forward_ref"),Ae=Symbol.for("react.suspense"),Ce=Symbol.for("react.memo"),Ee=Symbol.for("react.lazy"),ee=Symbol.iterator;function Te(e){return e===null||typeof e!="object"?null:(e=ee&&e[ee]||e["@@iterator"],typeof e=="function"?e:null)}var te={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ne=Object.assign,re={};function A(e,t,n){this.props=e,this.context=t,this.refs=re,this.updater=n||te}A.prototype.isReactComponent={},A.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},A.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function oe(){}oe.prototype=A.prototype;function H(e,t,n){this.props=e,this.context=t,this.refs=re,this.updater=n||te}var W=H.prototype=new oe;W.constructor=H,ne(W,A.prototype),W.isPureReactComponent=!0;var ae=Array.isArray,ie=Object.prototype.hasOwnProperty,G={current:null},se={key:!0,ref:!0,__self:!0,__source:!0};function le(e,t,n){var r,o={},a=null,s=null;if(t!=null)for(r in t.ref!==void 0&&(s=t.ref),t.key!==void 0&&(a=""+t.key),t)ie.call(t,r)&&!se.hasOwnProperty(r)&&(o[r]=t[r]);var c=arguments.length-2;if(c===1)o.children=n;else if(1<c){for(var u=Array(c),f=0;f<c;f++)u[f]=arguments[f+2];o.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps,c)o[r]===void 0&&(o[r]=c[r]);return{$$typeof:I,type:e,key:a,ref:s,props:o,_owner:G.current}}function Ne(e,t){return{$$typeof:I,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function J(e){return typeof e=="object"&&e!==null&&e.$$typeof===I}function Ie(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var ce=/\/+/g;function Q(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ie(""+e.key):t.toString(36)}function D(e,t,n,r,o){var a=typeof e;(a==="undefined"||a==="boolean")&&(e=null);var s=!1;if(e===null)s=!0;else switch(a){case"string":case"number":s=!0;break;case"object":switch(e.$$typeof){case I:case ve:s=!0}}if(s)return s=e,o=o(s),e=r===""?"."+Q(s,0):r,ae(o)?(n="",e!=null&&(n=e.replace(ce,"$&/")+"/"),D(o,t,n,"",function(f){return f})):o!=null&&(J(o)&&(o=Ne(o,n+(!o.key||s&&s.key===o.key?"":(""+o.key).replace(ce,"$&/")+"/")+e)),t.push(o)),1;if(s=0,r=r===""?".":r+":",ae(e))for(var c=0;c<e.length;c++){a=e[c];var u=r+Q(a,c);s+=D(a,t,n,u,o)}else if(u=Te(e),typeof u=="function")for(e=u.call(e),c=0;!(a=e.next()).done;)a=a.value,u=r+Q(a,c++),s+=D(a,t,n,u,o);else if(a==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return s}function O(e,t,n){if(e==null)return e;var r=[],o=0;return D(e,r,"","",function(a){return t.call(n,a,o++)}),r}function Re(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var p={current:null},B={transition:null},Pe={ReactCurrentDispatcher:p,ReactCurrentBatchConfig:B,ReactCurrentOwner:G};function ue(){throw Error("act(...) is not supported in production builds of React.")}i.Children={map:O,forEach:function(e,t,n){O(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return O(e,function(){t++}),t},toArray:function(e){return O(e,function(t){return t})||[]},only:function(e){if(!J(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},i.Component=A,i.Fragment=Se,i.Profiler=_e,i.PureComponent=H,i.StrictMode=be,i.Suspense=Ae,i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Pe,i.act=ue,i.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=ne({},e.props),o=e.key,a=e.ref,s=e._owner;if(t!=null){if(t.ref!==void 0&&(a=t.ref,s=G.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)ie.call(t,u)&&!se.hasOwnProperty(u)&&(r[u]=t[u]===void 0&&c!==void 0?c[u]:t[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var f=0;f<u;f++)c[f]=arguments[f+2];r.children=c}return{$$typeof:I,type:e.type,key:o,ref:a,props:r,_owner:s}},i.createContext=function(e){return e={$$typeof:je,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:xe,_context:e},e.Consumer=e},i.createElement=le,i.createFactory=function(e){var t=le.bind(null,e);return t.type=e,t},i.createRef=function(){return{current:null}},i.forwardRef=function(e){return{$$typeof:$e,render:e}},i.isValidElement=J,i.lazy=function(e){return{$$typeof:Ee,_payload:{_status:-1,_result:e},_init:Re}},i.memo=function(e,t){return{$$typeof:Ce,type:e,compare:t===void 0?null:t}},i.startTransition=function(e){var t=B.transition;B.transition={};try{e()}finally{B.transition=t}},i.unstable_act=ue,i.useCallback=function(e,t){return p.current.useCallback(e,t)},i.useContext=function(e){return p.current.useContext(e)},i.useDebugValue=function(){},i.useDeferredValue=function(e){return p.current.useDeferredValue(e)},i.useEffect=function(e,t){return p.current.useEffect(e,t)},i.useId=function(){return p.current.useId()},i.useImperativeHandle=function(e,t,n){return p.current.useImperativeHandle(e,t,n)},i.useInsertionEffect=function(e,t){return p.current.useInsertionEffect(e,t)},i.useLayoutEffect=function(e,t){return p.current.useLayoutEffect(e,t)},i.useMemo=function(e,t){return p.current.useMemo(e,t)},i.useReducer=function(e,t,n){return p.current.useReducer(e,t,n)},i.useRef=function(e){return p.current.useRef(e)},i.useState=function(e){return p.current.useState(e)},i.useSyncExternalStore=function(e,t,n){return p.current.useSyncExternalStore(e,t,n)},i.useTransition=function(){return p.current.useTransition()},i.version="18.3.1",Z.exports=i;var C=Z.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Le=C,Me=Symbol.for("react.element"),De=Symbol.for("react.fragment"),Oe=Object.prototype.hasOwnProperty,Be=Le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ue={key:!0,ref:!0,__self:!0,__source:!0};function fe(e,t,n){var r,o={},a=null,s=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)Oe.call(t,r)&&!Ue.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:Me,type:e,key:a,ref:s,props:o,_owner:Be.current}}M.Fragment=De,M.jsx=fe,M.jsxs=fe,Y.exports=M;var d=Y.exports;const Fe=e=>{if(e===null||typeof e>"u")return"N/A";if(e<0)return"Data przyszła (podejrzane)";if(e<30)return`${e} dni (bardzo młoda)`;if(e<180)return`${Math.floor(e/30)} mies. (młoda)`;if(e<365)return`${Math.floor(e/30)} mies. (poniżej roku)`;const t=Math.floor(e/365),n=Math.floor(e%365/30);return`${t} ${t===1?"r.":"l."}${n>0?` i ${n}m.`:""} (dojrzała)`};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),pe=(...e)=>e.filter((t,n,r)=>!!t&&r.indexOf(t)===n).join(" ");/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var qe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=C.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:o="",children:a,iconNode:s,...c},u)=>C.createElement("svg",{ref:u,...qe,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:pe("lucide",o),...c},[...s.map(([f,h])=>C.createElement(f,h)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=(e,t)=>{const n=C.forwardRef(({className:r,...o},a)=>C.createElement(He,{ref:a,iconNode:t,className:pe(`lucide-${Ve(e)}`,r),...o}));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=_("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=_("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=_("MessageSquareQuote",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M8 12a2 2 0 0 0 2-2V8H8",key:"1jfesj"}],["path",{d:"M14 12a2 2 0 0 0 2-2V8h-2",key:"1dq9mh"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=_("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=_("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=_("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=_("ShieldQuestion",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),l={age:{y:-15,vy:-25,m:10,vm:15,unknown:-5},ssl:{v:10,e:-20,p:-20,h:-25,es:-5,unknown:-10},bl:{l:-35,c:5},ip:-20,urlAi:{ph:-30,pm:-15,lh:10,ll:0,error:-5},cAi:{ah:-25,ap:-15,ml:5,error:-5,noContent:0}};function Ye(e,t){if(!(e!=null&&e.analysis))return console.warn("[ScoreCalc] No analysis data provided for score calculation."),{score:null,explanations:[]};const n=e.analysis,r=e.urlTextAnalysis,o=e.pageContentAnalyses;let a=50;const s=[],c=100,u=0;console.log("[ScoreCalc] Starting calculation. Initial score:",a,"for URL:",t),console.log("[ScoreCalc] DomainAnalysisDetails:",JSON.parse(JSON.stringify(n))),console.log("[ScoreCalc] UrlTextAnalysis:",JSON.parse(JSON.stringify(r||{}))),console.log("[ScoreCalc] PageContentAnalyses:",JSON.parse(JSON.stringify(o||[])));const f=n.domain_actual_age_days;let h="neutral",m="0 pkt",ge="N/A";f!==null&&typeof f<"u"?(ge=Fe(f),f<30?(a+=l.age.vy,h="negative",m=`${l.age.vy} pkt`):f<180?(a+=l.age.y,h="negative",m=`${l.age.y} pkt`):f>=730?(a+=l.age.vm,h="positive",m=`+${l.age.vm} pkt`):f>=365&&(a+=l.age.m,h="positive",m=`+${l.age.m} pkt`)):(a+=l.age.unknown,h="info",m=`${l.age.unknown} pkt (brak danych)`),s.push({id:"age",icon:We,label:"Wiek domeny",valueText:ge,impact:h,scoreEffect:m,details:"Starsze domeny są generalnie bardziej wiarygodne.",longDesc:"Nowo zarejestrowane domeny są często wykorzystywane w kampaniach phishingowych..."});let E="negative",j="Strona nie używa szyfrowania HTTPS.",$="Brak (HTTP)",g=l.ssl.h;if(n.parsed_url_scheme==="https")if(g=0,n.ssl_info&&n.ssl_info.not_after){const y=new Date(n.ssl_info.not_after),q=new Date,L=(y.getTime()-q.getTime())/(1e3*3600*24);L>0?(g=l.ssl.v,E="positive",$="Ważny",j=`Połączenie szyfrowane. Certyfikat ważny do: ${y.toLocaleDateString()}.`,L<30&&(g+=l.ssl.es,$=d.jsx("span",{className:"text-yellow-600 font-semibold",children:"Wygasa wkrótce!"}),j+=" Certyfikat wygasa za mniej niż 30 dni.")):(g=l.ssl.e,E="negative",$="Wygasł",j=`Certyfikat SSL wygasł: ${y.toLocaleDateString()}.`)}else g=l.ssl.p,E="negative",$="Problem (HTTPS)",j="Strona używa HTTPS, ale wystąpił problem z weryfikacją certyfikatu...";else n.ssl_info===null&&n.parsed_url_scheme!=="https"?(E="negative",$="Brak (HTTP)",j="Strona nie używa szyfrowania HTTPS (HTTP)."):(g=l.ssl.unknown,E="info",$="N/A (SSL)",j="Nie udało się jednoznacznie zweryfikować statusu SSL.");a+=g;const et=`${g>0?"+":""}${g} pkt`;s.push({id:"ssl",icon:Ge,label:"Szyfrowanie (SSL)",valueText:$,impact:E,details:j,scoreEffect:et,longDesc:"Certyfikat SSL zapewnia szyfrowanie danych przesyłanych między Tobą a stroną..."});let w=0,U="Niedostępna",T="neutral",F="Analiza AI adresu URL nie została przeprowadzona lub jest niedostępna.";r===null?(w=l.urlAi.error,U=d.jsx("span",{className:"text-red-500",children:"Błąd analizy"}),T="negative",F="Nie udało się przeprowadzić analizy AI dla tego URL z powodu błędu."):r?(U=`${r.label} (${(r.confidence*100).toFixed(0)}%)`,F=`Model AI ocenił URL jako ${r.label.toLowerCase()} z ${(r.confidence*100).toFixed(0)}% pewnością.`,r.is_phishing?(T="negative",r.confidence>.9?w=l.urlAi.ph:w=l.urlAi.pm):r.confidence>.9?(w=l.urlAi.lh,T="positive"):(w=l.urlAi.ll,T="neutral")):(U=d.jsx("span",{className:"text-gray-500",children:"N/A (URL AI)"}),T="neutral",F="Analiza AI adresu URL nie została jeszcze przeprowadzona lub dane nie są dostępne."),s.push({id:"aiUrl",icon:Xe,label:"Analiza AI URL",valueText:U,impact:T,scoreEffect:`${w>0?"+":""}${w} pkt`,details:F,longDesc:"Sztuczna inteligencja analizuje strukturę i komponenty adresu URL..."}),a+=w;let z="N/A",v="neutral",S=0,b="Analiza treści strony nie została przeprowadzona lub brakło tekstu.",V="Analiza treści strony wyszukuje fragmenty mogące wskazywać na oszustwo...";const R=[];if(o===null)z=d.jsx("span",{className:"text-red-500",children:"Błąd analizy treści"}),v="negative",S=l.cAi.error,b="Wystąpił błąd podczas próby analizy treści strony.";else if(o&&o.length>0){let y=0,q=!1,L=0;if(o.forEach(k=>{k.is_phishing&&(y++,L+=k.confidence,k.confidence>.9&&(q=!0),R.push({label:k.label,conf:k.confidence,chunk:k.originalChunk}))}),q?(S=l.cAi.ah,v="negative",z=d.jsx("span",{className:"text-red-500 font-semibold",children:"Podejrzane Treści!"}),b=`Wykryto fragmenty treści o wysokim prawdopodobieństwie phishingu (${y}/${o.length}).`):y>0?L/y>.5?(S=l.cAi.ap,v="negative",z="Podejrzane fragmenty",b=`Wykryto ${y} z ${o.length} fragmentów jako potencjalnie phishingowe.`):(v="info",z="Niejednoznaczne",b=`Niektóre fragmenty (${y}/${o.length}) wydają się niejednoznaczne.`):(S=l.cAi.ml,v="positive",z="Treść OK",b=`Analiza treści (${o.length} fragmentów) nie wykazała znamion phishingu.`),R.length>0){const k=R.slice(0,3).map((N,tt)=>d.jsxs("li",{title:N.chunk,className:"mb-1",children:[d.jsxs("span",{className:`font-semibold ${N.label==="PHISHING"?"text-red-600":"text-gray-700"}`,children:['"',N.chunk.substring(0,50),'..."']}),d.jsxs("span",{className:"text-gray-500 ml-1",children:["(",N.label," ",(N.conf*100).toFixed(0),"%)"]})]},`chunk-${tt}-${N.chunk.slice(0,5)}`));V=d.jsxs("div",{children:[d.jsx("p",{children:typeof V=="string"?V:"Szczegóły analizy treści:"}),d.jsx("p",{className:"mt-2 font-semibold",children:"Podejrzane fragmenty:"}),d.jsx("ul",{className:"list-disc pl-5 max-h-24 overflow-y-auto text-xs custom-scrollbar",children:k}),R.length>3&&d.jsxs("p",{className:"text-xs mt-1",children:["...i ",R.length-3," więcej."]})]})}}else o&&o.length===0?(S=l.cAi.noContent,v="info",z="Brak tekstu do analizy",b="Nie znaleziono wystarczającej ilości tekstu na stronie do przeprowadzenia pełnej analizy treści."):(z=d.jsx("span",{className:"text-gray-500",children:"N/A (treść)"}),v="neutral",b="Analiza treści strony nie została jeszcze przeprowadzona lub dane nie są dostępne.");a+=S,s.push({id:"contentAi",icon:Je,label:"Analiza AI treści",valueText:z,impact:v,scoreEffect:`${S>0?"+":""}${S} pkt`,details:b,longDesc:V});let ke=!1,P=0;const we=[];n.blacklist_checks&&n.blacklist_checks.forEach(y=>{y.is_listed&&(ke=!0,we.push(y.source))}),ke?(P=l.bl.l,s.push({id:"blacklist",icon:Qe,label:"Listy zagrożeń",valueText:`Na listach: ${we.join(", ")}`,impact:"negative",scoreEffect:`${P} pkt`,details:"Znalezienie na publicznej liście zagrożeń jest silnym sygnałem ostrzegawczym.",longDesc:"Te listy są kompilowane przez organizacje bezpieczeństwa..."})):(P=l.bl.c,s.push({id:"blacklist",icon:Ke,label:"Listy zagrożeń",valueText:"Czysto",impact:"positive",scoreEffect:`+${P} pkt`,details:"Nie znaleziono na znanych listach zagrożeń.",longDesc:"Brak wpisów na głównych listach zagrożeń to dobry znak..."})),a+=P;let X=0;n.is_ip_address_in_url?(X=l.ip,s.push({id:"ipInUrl",icon:de,label:"Adres IP w URL",valueText:"Tak",impact:"negative",scoreEffect:`${X} pkt`,details:"Używanie adresu IP zamiast nazwy domenowej jest częstą taktyką w phishingu.",longDesc:"Legalne strony rzadko używają adresów IP bezpośrednio w linkach..."})):s.push({id:"ipInUrl",icon:de,label:"Adres IP w URL",valueText:"Nie",impact:"positive",details:"URL używa standardowej nazwy domenowej.",scoreEffect:"+0 pkt"}),a+=X;const ze=Math.max(u,Math.min(c,Math.round(a)));return console.log(`[ScoreCalc] Final calculated score: ${ze} (raw score before clamp: ${a})`),{score:ze,explanations:s}}const ye="http://127.0.0.1:8000/api/v1",K=e=>{try{return new URL(e).hostname.replace(/^www\./,"")}catch{return""}},x=(e,t="#777777")=>{try{chrome.action.setBadgeText({text:e}),chrome.action.setBadgeBackgroundColor({color:t})}catch(n){console.warn("[BG] Failed to update badge.",n)}},he=(e,t)=>{if(!e)return;const{score:n}=Ye(e,t);if(n!==null){let r="#10B981";n<40?r="#EF4444":n<70&&(r="#F59E0B"),x(n.toString(),r)}else e.error?x("!","#EF4444"):x("?","#777777")},me=async e=>{try{const t=await fetch(`${ye}/check_phishing_text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text_to_analyze:e})});return t.ok?await t.json():null}catch(t){return console.error("[BG] fetchTextAnalysis Network Error:",t),null}},Ze=async(e,t=[])=>{const n=K(e);if(!n)return{error:"Invalid domain",lastChecked:Date.now()};x("...","#F59E0B");try{const[r,o]=await Promise.all([fetch(`${ye}/analyze_domain_details`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})}),me(e)]);if(!r.ok)return{error:"API Error (domain details)",lastChecked:Date.now()};const a=await r.json();if(a.error)return{error:a.error,lastChecked:Date.now()};let s=[];if(t.length>0){const u=t.map(async(f,h)=>{const m=await me(f);return m?{...m,chunkIndex:h,originalChunk:f.substring(0,100)+"..."}:null});s=(await Promise.all(u)).filter(f=>f!==null)}const c={analysis:a,urlTextAnalysis:o,pageContentAnalyses:s,lastChecked:Date.now()};return chrome.storage.local.set({[n]:c}),he(c,e),c}catch(r){const o=r instanceof Error?r.message:String(r);return x("!","#EF4444"),{error:`Network/Parsing error: ${o}`,lastChecked:Date.now()}}};chrome.runtime.onMessage.addListener((e,t,n)=>{var r;if(e.action==="analyzePageContent")return console.log(`[BG] Received content for analysis from ${e.url}`),Ze(e.url,e.contentChunks).then(o=>{chrome.runtime.sendMessage({action:"analysisUpdated",domain:K(e.url),data:o,forUrl:e.url}).catch(()=>{}),n({success:!0})}).catch(o=>n({success:!1,error:o.message})),!0;if(e.action==="requestAnalysisForCurrentTab"){const o=e.url,a=e.tabId||((r=t.tab)==null?void 0:r.id);return o&&a?(console.log(`[BG] Manual refresh requested for ${o} on tab ${a}`),x("...","#F59E0B"),chrome.tabs.sendMessage(a,{action:"getTextContentFromPage"}),n({status:"refresh_triggered"})):n({error:"No active tab/URL to refresh."}),!0}return!1}),chrome.tabs.onActivated.addListener(async e=>{chrome.tabs.get(e.tabId,t=>{if(t.url){const n=K(t.url);chrome.storage.local.get(n,r=>{const o=r[n];o?(console.log(`[BG] onActivated: Found cached data for ${n}`),he(o,t.url)):x("","#777777")})}})}),chrome.runtime.onInstalled.addListener(async e=>{if(e.reason==="install"||e.reason==="update"){console.log("[BG] Extension installed/updated. Injecting content scripts into existing tabs.");const t=await chrome.tabs.query({url:["http://*/*","https://*/*"],status:"complete"});for(const n of t)if(n.id)try{await chrome.scripting.executeScript({target:{tabId:n.id},files:["src/content/content.js"]}),console.log(`[BG] Injected content script into tab ${n.id}`)}catch(r){console.warn(`[BG] Failed to inject script into tab ${n.id}:`,r)}}}),console.log("[BG] Background script loaded and listeners attached (v1.2.1).")})();
